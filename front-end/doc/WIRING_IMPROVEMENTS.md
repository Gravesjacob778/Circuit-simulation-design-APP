# 元件連接方式改進

## 改進內容

### 1. 點擊端點自動顯示連接畫面
- **舊方式**：使用者需要手動拖曳來連接元件
- **新方式**：點擊元件端點即可進入連接模式，系統自動顯示視覺回饋

### 2. 視覺回饋增強

#### 起點標記
當點擊第一個端點時，系統會立即顯示：
- **脈衝動畫圓點**：在起點位置顯示帶有脈衝動畫效果的黃色圓點
- **提示文字**：顯示「點擊目標端點完成連接」的提示訊息
- **陰影效果**：增加陰影效果，讓起點更明顯

#### 端點 Hover 效果
- **正常模式**：滑鼠懸停時端點變大並顯示黃色邊框
- **連接模式**：
  - **可連接的端點**：顯示綠色邊框和發光效果，游標變為 pointer
  - **不可連接的端點**（同一個端點）：顯示紅色邊框，游標變為 not-allowed

#### 連接預覽
- 滑鼠移動時顯示黃色虛線預覽連接路徑
- 使用直角走線（Manhattan Routing）算法

### 3. 取消連接
支援多種方式取消連接：
- 點擊同一個端點
- 按下 Escape 鍵
- 點擊畫布背景
- 所有取消操作都會正確停止動畫並清理視覺效果

## 使用方式

1. **開始連接**：點擊任意元件的端點
   - 系統顯示脈衝動畫和提示文字
   - 進入連接模式

2. **完成連接**：點擊目標元件的端點
   - 可連接的端點會顯示綠色高亮
   - 點擊後自動建立連線

3. **取消連接**：
   - 再次點擊起點端點
   - 按下 Escape 鍵
   - 點擊畫布空白處

## 技術細節

### 修改的檔案
- `front-end/src/components/workspace/CircuitCanvas.vue`

### 主要改動
1. `handlePortClick` 函數：添加起點視覺回饋和脈衝動畫
2. 端點 `mouseenter` 事件：根據連接模式顯示不同的視覺效果
3. 端點 `mouseleave` 事件：清理陰影效果
4. `handleStageClick` 和 `handleKeyDown`：確保取消時正確停止動畫

### 動畫管理
- 使用 Konva.Animation 建立脈衝動畫
- 將動畫引用儲存在 tempLayer 上，方便後續清理
- 在所有取消場景中都確保停止動畫並清理資源

## 測試建議

1. 測試基本連接流程
2. 測試取消連接的各種方式
3. 測試端點 hover 效果在不同模式下的表現
4. 測試連接預覽線的顯示
5. 測試不能連接到同一端點的限制
